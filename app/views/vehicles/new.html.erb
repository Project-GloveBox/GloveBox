<ons-navigator id="myNavigator">
  <ons-page>
  <ons-toolbar>
    <div class="left">
        <ons-icon icon="fa-car" style="padding: 5px"></ons-icon>
    </div>
    <div class="toolbar__center">
        <%= "#{current_user.first_name}'s GloveBox" %>
    </div>
    <div class="right">
      <ons-toolbar-button>
        <ons-icon icon="md-menu"></ons-icon>
      </ons-toolbar-button>
    </div>
  </ons-toolbar>

    <ons-tabbar position="auto">
      <ons-tab page="index.html" active icon="ion-home" label="Home"></ons-tab>
      <ons-tab icon="md-plus" label="Add Vehicle" page="new.html"></ons-tab>
      <ons-tab icon="ion-ios-cog" label="Maintenance" page="/maintenance_logs/new.html"></ons-tab>
    </ons-tabbar>
  </ons-page>
</ons-navigator>

<template id="index.html">
  <ons-page>
    <p class="intro" style="text-align: center">
      Welcome to GloveBox!<br>
    </p>
    <p class="intro" style="text-align: center">
      <em>The place where you can maintain your maintenance. </em><br><br>
    </p>
<%@vehicles.each do |vehicle| %>
    <ons-card>
    <img src="https://monaca.io/img/logos/download_image_onsenui_01.png" alt="Onsen UI" style="width: 100%">
    <div class="title">
      <%= vehicle.name %>
    </div>
    <div class="content">
      <ons-list>
        <ons-list-header></ons-list-header>
        <ons-list-item><%= vehicle.make %></ons-list-item>
        <ons-list-item><%= vehicle.model %></ons-list-item>
        <ons-list-item><%= vehicle.year %></ons-list-item>
        <ons-list-item><%= vehicle.license_plate %></ons-list-item>
        <ons-list-item><%= vehicle.color %></ons-list-item>    
      </ons-list>
    </div>
  </ons-card>
<%end%>
    <div style="text-align: center">
      <br>
      <ons-button class="button button--material" onclick="addVehicle()">
        Add a Vehcile
      </ons-button>
    </div>
  </ons-page>
</template>



<template id="new.html">
  <ons-page>
  <br>
  <%= form_for @vehicle,local: true, url: vehicles_path,:html => { :onsubmit => "submit_vehicle(this)" }  do |f| %>
    <ons-list modifier="inset">
      <ons-list-header>Vehcile Information</ons-list-header>
      <ons-list-item modifier="longdivider"><%= f.text_field :name, autocomplete: "name", class: 'text-input', placeholder: 'Vehicle Nickname' %></ons-list-item>
      <ons-list-item modifier="longdivider"><%= f.text_field :color, autocomplete: "color", class: 'text-input', placeholder: 'Color' %></ons-list-item>
    </ons-list>
    <br>
    <ons-list modifier="inset">
      <ons-list-item modifier="longdivider"><%= f.text_field :make, autocomplete: "make", class: 'text-input', placeholder: 'Make' %></ons-list-item>
      <ons-list-item modifier="longdivider"><%= f.text_field :model, autocomplete: "model", class: 'text-input', placeholder: 'Model' %></ons-list-item>
      <ons-list-item modifier="longdivider"><%= f.text_field :year, autocomplete: "year", class: 'text-input', placeholder: 'Year' %></ons-list-item>
    </ons-list>
    <br>
    <ons-list modifier="inset">
      <ons-list-item modifier="longdivider"><%= f.text_field :vin, autocomplete: "vin", class: 'text-input', placeholder: 'VIN' %></ons-list-item>
      <ons-list-item modifier="longdivider"><%= f.text_field :license_plate, autocomplete: "license_plate", class: 'text-input', placeholder: 'License Plate #' %></ons-list-item>
      <ons-list-item modifier="longdivider"><%= f.text_field :inspection, autocomplete: "inspection", class: 'text-input', placeholder: 'Date of last Inspection' %></ons-list-item>
    </ons-list>
        <%=f.submit id:"form-submit" %>
    <% end %>

    <div style="text-align: center">
      <br>
      <ons-button class="button button--material" onclick="preview()">
        Preview
      </ons-button>
    </div>
  </ons-page>
</template>

<template id="show.html">
  <ons-page id="show">
    <ons-toolbar>
      <div class="left">
        <ons-back-button>Back</ons-back-button>
      </div>
    </ons-toolbar>

    <ons-card>
    <img src="https://monaca.io/img/logos/download_image_onsenui_01.png" alt="Onsen UI" style="width: 100%">
    <div class="title">
      <%= @vehicle.name %>
    </div>
    <div class="content">
      <ons-list>
        <ons-list-header></ons-list-header>
        <ons-list-item><%= @vehicle.make %></ons-list-item>
        <ons-list-item><%= @vehicle.model %></ons-list-item>
        <ons-list-item><%= @vehicle.year %></ons-list-item>
        <ons-list-item><%= @vehicle.license_plate %></ons-list-item>
        <ons-list-item><%= @vehicle.color %></ons-list-item>    
      </ons-list>
    </div>
  </ons-card>

    <div style="text-align: center">
      <br>
      <ons-button class="button button--material" id='submit_button' >
        SUBMIT
      </ons-button>
    </div>

  </ons-page>
</template>

<template id="/maintenance_logs/new.html">
  <ons-page>
    <h2>this page should link to maintenance_logs</h2>
  </ons-page>
</template>
<style>
 #form-submit{
   
 }
</style>
<script>
var vehicle_form 

function addVehicle(){
  myNavigator.pushPage('new.html').then(function(){
      vehicle_form = document.getElementById("new_vehicle")
      submit_vehicle(vehicle_form)
  })
  
  
}

function submit_vehicle(form_element){
  var xhr = new XMLHttpRequest();
  console.log(form_element);
  
    // xhr.onload = function(){ alert ("success"); } // success case
    // xhr.onerror = function(){ alert ("Oh Uh"); } // failure case
    xhr.open (form_element.method, form_element.action, true);
    xhr.send (new FormData (form_element));
    return false;
}
function preview(){
  myNavigator.pushPage('show.html').then(function(){
    var submit_button  = document.getElementById("submit_button")
    submit_button.addEventListener('click', function(e){
      vehicle_form.submit();
    })
  })
}

function submit(){
    var frmsubmit = document.getElementById("form-submit")
    myNavigator.popPage(["slide"])
    frmsubmit.click();
}
// document.addEventListener('init', function(event) {
//   var page = event.target;

//   if (page.id === 'page1') {
//     page.querySelector('#push-button').onclick = function() {
//       document.querySelector('#myNavigator').pushPage('page2.html');
//     };
//   } else if (page.id === 'page2') {
//     page.querySelector('ons-toolbar .center').innerHTML = page.data.title;
//   }
// });
function validateFields(){
  

}
</script>